# NOAA Oracle Helm Chart Values
# Weather data oracle API for DLC-based prediction markets

replicaCount: 1

image:
  repository: ghcr.io/tee8z/noaa-oracle
  tag: ""  # Defaults to appVersion
  pullPolicy: IfNotPresent

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  annotations: {}
  name: ""
  automount: true

service:
  type: ClusterIP
  port: 9800

ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts: []
  tls: []

resources:
  requests:
    memory: 128Mi
    cpu: 50m
  limits:
    memory: 256Mi

podSecurityContext: {}
securityContext: {}

# Health check configuration
healthCheck:
  path: /oracle/pubkey
  port: 9800

livenessProbe:
  httpGet:
    path: /oracle/pubkey
    port: http
  initialDelaySeconds: 10
  periodSeconds: 30
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /oracle/pubkey
    port: http
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

# Persistence for weather data and event database
persistence:
  enabled: true
  storageClass: ""
  accessMode: ReadWriteOnce
  size: 10Gi
  mountPath: /var/lib/noaa-oracle

# Litestream S3 backup for SQLite event database
litestream:
  enabled: false
  image:
    repository: litestream/litestream
    tag: "0.5.6"
  s3Bucket: ""
  s3Path: "noaa-oracle/events.sqlite"
  s3Region: "us-east-1"
  s3Endpoint: ""
  s3ForcePathStyle: false
  s3AccessKeyId: ""
  s3SecretAccessKey: ""
  syncInterval: "10s"
  retention: "168h"
  snapshotInterval: "1h"
  # Encryption key for Litestream backups (age key format)
  encryptionKey: ""
  encryptionKeySecret:
    enabled: false
    name: ""
    key: "encryption-key"
  useIAMRole: false

# Application configuration
config:
  # Logging level: trace, debug, info, warn, error
  level: "info"
  # Server binding
  host: "0.0.0.0"
  port: 9800
  # Public URL for API responses
  remoteUrl: ""
  # Weather data directory (parquet files)
  dataDir: /var/lib/noaa-oracle/weather
  # Event database directory (SQLite)
  eventDb: /var/lib/noaa-oracle/events
  # UI static files
  uiDir: /usr/share/noaa-oracle/ui
  # Private key path for signing
  privateKeyPath: /etc/noaa-oracle/keys/oracle.pem

# Environment variables
env: {}
envFrom: []

nodeSelector: {}
tolerations: []
affinity: {}

podAnnotations: {}
podLabels: {}

metrics:
  enabled: false
  path: /metrics
  interval: 30s

# Secrets configuration
secrets:
  privateKey:
    # Set to true to create a secret from the value below
    create: false
    # The private key PEM content (for local dev only - use external secrets in prod)
    value: ""

# Dev mode configuration for fast local development
# Uses locally-compiled cargo binaries instead of container images
devMode:
  enabled: false
  # Path to the binary inside the k3d node (mounted from host)
  hostPath: /mnt/noaa-oracle/oracle
  # Base image for running the binary (must have libc, ssl, etc.)
  baseImage: debian:bookworm-slim

# Weather data cleanup configuration
cleanup:
  # Enable the cleanup cronjob
  enabled: false
  # Cron schedule (default: daily at 3am)
  schedule: "0 3 * * *"
  # Directory containing dated weather data folders
  weatherDataDir: /var/lib/noaa-oracle/weather
  # Number of days to retain weather data
  retentionDays: 32
